<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Siri Max Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles/global.css" />
  </head>
  <body>
    <!-- Background ambient glow -->
    <div class="background-glow"></div>

    <!-- Status bar -->
    <div class="status-bar">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">Connecting...</span>
    </div>

    <!-- Theme toggle button -->
    <div class="theme-toggle" id="themeToggle">🌙</div>

    <!-- Main container -->
    <div class="container">
      <!-- Siri Orb -->
      <div class="siri-orb" id="siriOrb">
        <div class="orb-outer"></div>
        <div class="orb-middle"></div>
        <div class="orb-inner"></div>
        <div class="orb-core"></div>
      </div>

      <!-- Central text display -->
      <div class="text-display">
        <div class="mode-indicator" id="modeIndicator">Initializing</div>
        <div class="transcription loading" id="transcription">Establishing neural connection...</div>
        <div class="response" id="response" style="display: none;"></div>
      </div>
    </div>

    <script>
      const apiUrl = 'http://192.168.0.150:5001/status';
      const statusDot = document.getElementById('statusDot');
      const statusText = document.getElementById('statusText');
      const modeIndicator = document.getElementById('modeIndicator');
      const transcriptionEl = document.getElementById('transcription');
      const responseEl = document.getElementById('response');
      const siriOrb = document.getElementById('siriOrb');
      const themeToggle = document.getElementById('themeToggle');
      const body = document.body;
      
      let isConnected = false;
      let currentMode = '';
      let isDarkMode = true;

      // Theme toggle functionality
      function toggleTheme() {
        isDarkMode = !isDarkMode;
        body.classList.toggle('light-mode', !isDarkMode);
        themeToggle.textContent = isDarkMode ? '🌙' : '☀️';
      }

      themeToggle.addEventListener('click', toggleTheme);

      async function fetchStatus() {
        try {
          statusText.textContent = 'Connecting...';
          
          const response = await fetch(apiUrl, {
            method: 'GET',
            headers: {
              'Content-Type': 'application/json',
            },
          });
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
          }
          
          const data = await response.json();

          // Update status
          if (!isConnected) {
            statusDot.classList.add('connected');
            statusText.textContent = 'Neural Link Active';
            isConnected = true;
          }

          // Update mode
          if (data.mode !== currentMode) {
            currentMode = data.mode;
            modeIndicator.textContent = data.mode.toUpperCase();
            
            // Add listening animation for AI mode
            if (data.mode === 'AI') {
              siriOrb.classList.add('listening');
            } else {
              siriOrb.classList.remove('listening');
            }
          }

          // Update transcription
          if (data.transcription) {
            transcriptionEl.textContent = data.transcription;
            transcriptionEl.classList.remove('loading');
          } else {
            transcriptionEl.textContent = "Listening for your voice...";
            transcriptionEl.classList.add('loading');
          }

          // Update response
          if (data.mode === "AI" && data.response) {
            responseEl.textContent = data.response;
            responseEl.style.display = 'block';
          } else {
            responseEl.style.display = 'none';
          }
          
          console.log('Status updated:', data);
          
        } catch (error) {
          console.error('Connection error:', error);
          
          // Update error state
          statusDot.classList.remove('connected');
          statusText.textContent = 'Connection Lost';
          transcriptionEl.textContent = `Connection failed: ${error.message}`;
          transcriptionEl.classList.add('loading');
          responseEl.style.display = 'none';
          modeIndicator.textContent = 'OFFLINE';
          siriOrb.classList.remove('listening');
          
          isConnected = false;
        }
      }

      // Initialize
      fetchStatus();
      setInterval(fetchStatus, 2000);

      // Add click interaction to orb (still toggles theme)
      siriOrb.addEventListener('click', () => {
        siriOrb.style.transform = 'scale(0.95)';
        setTimeout(() => {
          siriOrb.style.transform = 'scale(1)';
        }, 150);
        
        // Toggle theme when orb is clicked
        toggleTheme();
      });
    </script>
  </body>
</html>